<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://cdn.dwolla.com/1/dwolla.js"></script>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
</head>
<body>

  <img id="loadingSpinner" src="spin.svg"></img>

  <div id="iavContainer" onload="hideSpinner()">
    <!-- Place loading icon here, when iframe is loaded hide the image -->
    <!-- Once the iframe loads remove loading image onload="document.getElementById('loadImg').style.display='none' -->
  </div>

  <div id="logs">
  </div>

</body>



<script type="text/javascript">

var generateIAVTokenRan = false;
function generateIAVToken(){
	if(generateIAVTokenRan == false){
		console.log("Running IAV Generator");
		dwolla.configure('sandbox');
		//Enable the falling log to see iav_token passed
		$div = $('<div />');
		$div.text(JSON.stringify("Value of iav_token: " + iav_token));
		$('#logs').append($div);

		dwolla.iav.start(iav_token, {
			container: 'iavContainer',
			microDeposits: false,
			fallbackToMicroDeposits: true
		}, function(err, res) {
			console.log('Error: ' + JSON.stringify(err) + ' -- Response: ' + JSON.stringify(res));
			$div.text(JSON.stringify(err));
			$div.text(JSON.stringify(res));
			$('#logs').append($div);
		});
    var iframe = document.getElementById('iframe');
    console.log(iframe);
		generateIAVTokenRan = true;
	}

}


//Observer
// select the target node
var target = document.getElementById('iavContainer');
var loadingSpinner = document.getElementById("loadingSpinner");

// create an observer instance
var observer = new MutationObserver(function(mutations) {
  mutations.forEach(function(mutation) {
    console.log(mutation.type);
    loadingSpinner.style.display = 'none';
    // later, you can stop observing
    observer.disconnect();
  });
});

// configuration of the observer:
var config = { attributes: true, childList: true, characterData: true };

// pass in the target node, as well as the observer options
observer.observe(target, config);






</script>
</html>
